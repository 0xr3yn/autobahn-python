<!doctype html>
<html>
   <body>
      <h1>WAMP-Klein Application</h1>
      <p>Open JavaScript console to watch output.</p>

      <form action="squareform" method="post">
         <p>
            Square this <input type="number" name="x" value="{{ visits }}" />
         </p>
         <p>
            <input type="submit" />
         </p>
      </form>

      <script src="https://autobahn.s3.amazonaws.com/autobahnjs/latest/autobahn.min.jgz"></script>
      <script>
         var connection = new autobahn.Connection({
            url: "ws://127.0.0.1:9000",
            realm: 'realm1'
         });

         connection.onopen = function (session) {

            console.log("connected");

            session.subscribe('com.example.onvisit',

               function (args, kwargs) {

                  console.log('Visits: ' + kwargs.visits);

                  session.call('com.example.square', [kwargs.visits]).then(
                     function (res) {
                        console.log('Square: ' + res);
                     }
                  );
               }
            ).then(
               function (sub) {
                  console.log("subscribed")
               }
            );
         };

         connection.open();
      </script>
   </body>
</html>
