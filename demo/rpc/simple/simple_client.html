 <html>
   <head>
      <title>Autobahn WebSockets Simple RPC Demo</title>

      <script src="http://code.jquery.com/jquery-1.6.2.min.js"></script>
      <script src="../../../lib/javascript/autobahn.js"></script>
      <script>

         var sess = null;

         $(document).ready(function()
         {
            // To connect to a Autobahn WebSockets RPC server, just
            // create a new session providing the server URL and (optional)
            // onOpen and onClose/Error handlers

            sess = new ab.Session("ws://localhost:9000", function() { console.log("Connected!"); });
         });

         function test()
         {
            // Autobahn WebSockets returns a jQuery Deferred object
            // when a RPC call is initiated

            // http://api.jquery.com/category/deferred-object/

            // call a function and log result on success
            sess.call("square", 23).then(console.log);

            // call a function and call another function on success
            sess.call("square", 23).then(function(x) { sess.call("sqrt", x).then(console.log); } );

            // call a function, log on success, show alert on error
            sess.call("sqrt", -1).then(console.log, function(error) { alert(error); } );

            // call a function with list of numbers as arg
            sess.call("sum", [1,2,3,4,5]).then(console.log);

            // call a function that takes a long time, call another function
            // the result of the latter is received first, RPC is really asynchronous
            sess.call("asum", [1,2,3]).then(console.log);
            sess.call("sum", [4,5,6]).then(console.log);
         }

     </script>
   </head>
   <body>
      <button onclick="test()">Run Test</button>
   </body>
 </html>
